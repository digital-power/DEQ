/**
 @preserve Digital Event Queue.
 Copyright (c) 2016-2020: Digital Power B.V., All rights reserved.
 Licensed under the GNU Lesser General Public License v3.0:
 https://github.com/digital-power/DEQ/blob/master/LICENSE
 **/
!function(r){var n={};function a(e){if(n[e])return n[e].exports;var t=n[e]={i:e,l:!1,exports:{}};return r[e].call(t.exports,t,t.exports,a),t.l=!0,t.exports}a.m=r,a.c=n,a.d=function(e,t,r){a.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:r})},a.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},a.t=function(t,e){if(1&e&&(t=a(t)),8&e)return t;if(4&e&&"object"==typeof t&&t&&t.__esModule)return t;var r=Object.create(null);if(a.r(r),Object.defineProperty(r,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var n in t)a.d(r,n,function(e){return t[e]}.bind(null,n));return r},a.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return a.d(t,"a",t),t},a.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},a.p="",a(a.s=0)}([function(e,t,r){e.exports=r(1)},function(e,t,r){window.DEQFactory=r(2)},function(e,t,r){try{var n=r(!function(){var e=new Error("Cannot find module './DigitalEventQueueWithPersist'");throw e.code="MODULE_NOT_FOUND",e}())}catch(e){n=r(3)}var a,o,i="object"==typeof i?i:(o={},(a={}).get=function(e,t){return o.hasOwnProperty(e)?void 0!==t&&o[e].pushBulk(t):o[e]=new n(e,t),o[e]},a.getAll=function(){return o},a);e.exports=i},function(e,t){function r(e,t){var c=this;c.version="1.4.0 core",c.name=e,c.listeners=[],c.events=[],c.history=[],c.global={},c.__private={},c.__private.lib={mergeObj:function(){for(var e,t,r={},n=[].splice.call(arguments,0);0<n.length;)if(e=n.splice(0,1)[0],"[object Object]"==Object.prototype.toString.call(e))for(t in e)e.hasOwnProperty(t)&&("[object Object]"==Object.prototype.toString.call(e[t])?r[t]=c.__private.lib.mergeObj(r[t]||{},e[t]):r[t]=c.__private.lib.deepCopy(e[t]));return r},deepCopy:function(e){switch(Object.prototype.toString.call(e)){case"[object Object]":return c.__private.lib.copyObj(e);case"[object Array]":for(var t=[],r=0,n=e.length;r<n;r++)t[r]=c.__private.lib.deepCopy(e[r]);return t;default:return e}},copyObj:function(e){return c.__private.lib.mergeObj({},e)},logError:function(e,t,r){var n={};n.deq_error_type=e,n.deq_error_message=t,"object"==typeof r&&(r.fileName&&r.lineNumber&&(n.deq_error_location=r.fileName+" ("+r.lineNumber+")"),r.name&&r.message&&(n.deq_error_details=r.name+": "+r.message),r.stack&&(n.deq_error_stack=r.stack.toString()),r.deq_listener&&(n.deq_error_listener=r.deq_listener),r.deq_event&&(n.deq_error_event=r.deq_event)),c.push({command:"ADD EVENT",name:"deq error",data:n})},callEventCallback:function(t,e,r,n){try{var a=c.__private.lib.copyObj(e);r.call(r,t,a,c)}catch(e){"deq error"!=t&&(e.deq_listener=n,e.deq_event=t,c.__private.lib.logError("listener","listener ("+n+") failed on '"+t,e))}},checkAndExecuteEventMatch:function(e,t){try{var r=c.listeners[t],n=c.events[e];if(!(Array.isArray(r)&&3<=r.length))throw new Error("Invalid reference to listeners["+t+"] in checkAndExecuteEventMatch");if(!(Array.isArray(n)&&2<=n.length))throw new Error("Invalid reference to events["+e+"] in checkAndExecuteEventMatch");var a={name:n[0],data:n[1]},o={name:r[0],matchEvent:r[1],handler:r[2]},i=new RegExp("^"+o.matchEvent+"$","i");!a.name.match(i)||a.name.match(/^deq error$/i)&&".*"==o.matchEvent||c.__private.lib.callEventCallback(a.name,a.data,o.handler,o.name)}catch(e){c.__private.lib.logError("checkAndExecuteEventMatch",e.message,e)}},addListener:function(e){if("object"==typeof e&&"function"==typeof e.handler&&"string"==typeof e.matchEvent){e.name=e.name||"unnamed listener";var t=c.listeners.push([e.name,e.matchEvent,e.handler]);if(t--,!e.skipHistory)for(var r=0,n=c.events.length;r<n;r++)c.__private.lib.checkAndExecuteEventMatch(r,t)}else c.__private.lib.logError("add listener","invalid input",{deq_listener:e.name})},addEvent:function(t){if("string"!=typeof t.name||void 0!==t.data&&"object"!=typeof t.data){var e={};"string"==typeof t.name&&(e.deq_event=t.name),c.__private.lib.logError("add event","invalid input",e)}else{var r;try{r=c.__private.lib.mergeObj(c.global,t.data)}catch(e){return e.deq_event=t.name,c.__private.lib.logError("add event","invalid event object",e),!1}r.deq_event=t.name,r.deq_event_ts=(new Date).getTime();var n=c.events.push([t.name,r]);n--;for(var a=0,o=c.listeners.length;a<o;a++)c.__private.lib.checkAndExecuteEventMatch(n,a)}},addGlobalData:function(e){"object"==typeof e.data&&(c.global=c.__private.lib.mergeObj(c.global,e.data))}},c.__private.commandMapping={"ADD EVENT":c.__private.lib.addEvent,"ADD LISTENER":c.__private.lib.addListener,"GLOBAL DATA":c.__private.lib.addGlobalData},c.push=function(e){var t,r;c.history.push(e),"object"==typeof e&&"string"==typeof e.command?(t=e.command.toUpperCase(),r=c.__private.lib.copyObj(e),c.__private.commandMapping.hasOwnProperty(t)?c.__private.commandMapping[t].call(this,r):c.__private.lib.logError("push","command '"+t+"' is unknown")):c.__private.lib.logError("push","invalid input: use .push({command:'#command#',#param1#:'param1_value',...})")},c.pushBulk=function(e){if(Array.isArray(e))for(;0<e.length;)c.push(e.shift())},Object.getPrototypeOf(c).constructor===r&&c.pushBulk(t)}(r.prototype=[]).constructor=r,e.exports=r}]);